build:
  box: emojigen/docker-pyemoji
  steps:
    - install-packages:
      packages: ruby
    - script:
        name: install dependencies
        code: |
          ./.wercker/install.sh
    - script:
        name: build externals
        code: |
          ./.wercker/build_externals.sh
    - script:
        name: build
        code: |
          /usr/local/python-3.5/bin/python setup.py bdist_wheel
          /usr/local/python-3.6/bin/python setup.py bdist_wheel
          cp build/lib.*/pyemoji.*.so .
    - script:
        name: test
        code: |
          python3 setup.py test
    - script:
        name: publish
        code: |
          python3 scripts/publish.py
    - script:
        name: output dummy file
        code: |
          touch $WERCKER_OUTPUT_DIR/dummy
  after-steps:
    - install-packages:
        packages: ruby
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
        channel: emoji
